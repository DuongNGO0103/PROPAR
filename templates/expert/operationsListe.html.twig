{% extends 'base.html.twig' %}

{% block title %}Mes opérations
{% endblock %}

{% block navbarlists %}
	<li>
		<a href="{{ path('app_expert') }}">Tableau de bord</a>
	</li>
	<li>
		<a href="{{ path('app_expert_operations') }}">Ajouter une opération</a>
	</li>
	<li>
		<a href="{{ path('app_liste_operations') }}">Lister mes opérations</a>
	</li>
	<li>
		<a href="{{ path('liste_employe') }}">Liste des employés</a>
	</li>
	<li>
		<a href="{{ path('inscription') }}">Ajouter un employé</a>
	</li>
	<li>
		<a href="{{ path('liste_employe_modifier') }}">Modifier un employé</a>
	</li>
	<li>
		<a href="{{ path('app_prise_commande_expert') }}">Ajouter commande client</a>
	</li>
	<li>
		<a href="{{ path('app_chiffre_affaire') }}">Chiffre d'affaire</a>
	</li>

{% endblock %}

{% block main2 %}

	<h3>Lister mes opérations</h3>
	<input id='adresse' type="text" placeholder="Recherche par id ou client" class="searchBar form-control">
	<p class="resultat row"></p>

	<div class="container text-center">
		<div class="row">
			<div class="col">
				<p class="titreCommande">ID</p>
			</div>
			<div class="col">
				<p class="titreCommande">COMMANDE</p>
			</div>
			<div class="col">
				<p class="titreCommande">DATE</p>
			</div>
			<div class="col">
				<p class="titreCommande">CLIENT</p>
			</div>
			<div class="col">
				<p class="titreCommande">OPERATION</p>
			</div>
			<div class="col">
				<p class="titreCommande">STATUT</p>
			</div>
			<div class="col"></div>
			<hr>
		</div>
		{# /////AFFICHAGE REPONSE///// #}

		{% for commandes in commandeProfil %}
			<div class=" row" style="margin-top:3%;">
				<div class=" col">
					{{commandes.id}}
				</div>
				<div class=" col">
					{{commandes.nomCommande}}
				</div>
				<div class=" col">
					{{ commandes.date|date("d/m/Y") }}
				</div>
				<div class=" col">
					{{commandes.client.nom}}
				</div>
				<div class=" col">
					{{commandes.operation.typeoperation}}
				</div>
				<div class=" col">
					{{commandes.statut}}
				</div>
				<div class=" col">
					{% if commandes.statut == "Terminer" %}
						<a href="{{path('afficherCommande',{'id':commandes.id})}}" style="color:#3D6A9E" class="boutton">PDF</a>
						{# <button type="submit" class="btn btn-primary">Modifier</button> #}
					{% endif %}
				</div>
			</div>
		{% endfor %}

		<script>

			$(document).ready(function () {
$("#adresse").keyup(function (e) {
e.preventDefault();
e.stopPropagation();
let input = $("#adresse").val();
if (input.length === 0) {
$('.resultat').empty();
return false;
}

$.ajax({
url: "https://localhost:8000/call/ajax/operationsListe",
type: 'GET',
data: {
q: $("#adresse").val()
},


success: function (response) {

let liste = "";
$.each(response, function (index, value) { // J'ajoute chaque élément dans une liste
console.log(value.id)
if (input == value.client.nom.toLowerCase() || input == value.id) {
liste += '<div class=" row" style="margin-top:3%; border:solid 1px #CBC6C5;padding:10px">' + '<div class="id col">' + value.id + '</div>' + '<div class="com col">' + value.nomCommande + '</div>' + '<div class="date col">' + new Date(value.date).toLocaleDateString() + '</div>' + '<div class="client col">' + value.client.nom + '</div>' + '<div class="ope col">' + value.operation.type_operation + '</div>' + '<div class="statut col">' + value.statut + '</div>' + '<div class="pdf col">' + "<a href=https://localhost:8000/pdf/" + value.id + " style='color:#3D6A9E' class='boutton'>" + " PDF " + '</a>' + '</div>' + '</div>'
}
});
$('.resultat').html(liste);
},


error: function (response) {
console.log(error)
}
});
});
});
		</script>
	</div>
{% endblock %}
{# liste += '<div class=" row" style="margin-top:3%">' + '<div class="id col">' + value.id + '</div>' + '<div class="com col">' + value.nomCommande + '</div>' + '<div class="date col">' + new Date(value.date).toLocaleDateString() + '</div>' + '<div class="client col">' + value.client.nom + '</div>' + '<div class="ope col">' + value.operation.type_operation + '</div>' + '<div class="statut col">' + value.statut + '</div>' + '<div class="pdf col">' + "<a href=" +"{{ path('afficherCommande',{'id':"value.id"}) }}>" + " PDF " + '</a>' + '</div>' + '</div>' #}
{# $(".id").append(value.id)
						$(".com").append(value.nomCommande)
						$(".date").append(value.date)
						$(".client").append(value.client.nom)
						$(".ope").append(value.operation.type_operation)
						$(".statut").append(value.statut)
						/////AFFICHAGE REPONSE///// 
						'<div class=" row" style="margin-top:3%">'
											'<div class="id col">'++'</div>'
											'<div class="com col">'++'</div>'
											'<div class="date col">'++'</div>'
											'<div class="client col">'++'</div>'
											'<div class="ope col">'++'</div>'
											'<div class="statut col">'++'</div>'
										'</div>'
						<a href="{{path('afficherCommande',{'id':commandes.id})}}" style="color:#3D6A9E" class="boutton">PDF</a>
						
						'<a #}
